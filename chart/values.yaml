# ---
# https://github.com/bjw-s/helm-charts/blob/main/charts/library/common/values.yaml

controllers:
  main:
    containers:
      main:
        image: 
          repository: ghcr.io/nvalembois/aeneria-front
          tag: 2.1.1-1.25.4-alpine3.18
        resources:
          limits:
            cpu: 500m
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop: [ 'ALL' ]
          seccompProfile:
            type: RuntimeDefault
      app:
        image: 
          repository: ghcr.io/nvalembois/aeneria-app
          tag: 2.1.1-fpm-alpine3.19
        resources:
          limits:
            cpu: 500m
            memory: 1Gi
          requests:
            cpu: 10m
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop: [ 'ALL' ]
          seccompProfile:
            type: RuntimeDefault

service:
  main:
    ports:
      http:
        port: 8123

serviceMonitor:
  main:
    enabled: false

ingress:
  main:
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: ingress-issuer
      cert-manager.io/common-name: aeneris.local
    hosts:
      - host: aeneris.local
        ## Configure the paths for the host
        paths:
          - path: /
            pathType: Prefix
            service:
              name: main
              port: http
    tls:
    - secretName: aeneris.local-tls
      hosts:
      - aeneris.local

persistence:
  # pgpass:
  #   enabled: true
  #   name: home-assistant-postgresql-app
  #   type: secret
  #   defaultMode: 0400
  #   items:
  #   - key: pgpass
  #     path: .pgpass
  #   - key: uri
  #     path: .pguri
  #   - key: host
  #     path: .pghost
  #   - key: user
  #     path: .pguser
  #   - key: user
  #     path: .pguser
  #   advancedMounts:
  #     main:
  #       main:
  #       - path: /root
  #         readOnly: true

# -- Configure the networkPolicies for the chart here.
# Additional networkPolicies can be added by adding a dictionary key similar to the 'main' networkPolicy.
# @default -- See below
networkpolicies:
  main:
    enabled: false
    controller: main
    policyTypes:
      - Ingress
      # - Egress
    rules:
      ingress:
        - from:
          - podSelector:
              matchLabels:
                app.kubernetes.io/component: envoy
                app.kubernetes.io/name: contour
            namespaceSelector:
              matchLabels:
                kubernetes.io/metadata.name: kube-coutour
          ports:
          - protocol: TCP
            port: 8123
  postgres:
    enabled: false
    podSelector:
      matchLabels:
        cnpg.io/cluster: home-assistant-postgresql
    policyTypes:
      - Ingress
    ingress:
      - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: "home-assistant"
              app.kubernetes.io/instance: "home-assistant"
        ports:
        - protocol: TCP
          port: 5432
      - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: "kube-postgresql-cnpg"
          podSelector:
            matchLabels:
              app.kubernetes.io/instance: "postgresql-cnpg"
              app.kubernetes.io/name: "cloudnative-pg"
        ports:
        - protocol: TCP
          port: 8000

database:
  type: cloudnative-pg
  database: aeneris
  username: aeneris
  size: 2Gi